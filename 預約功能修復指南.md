# 預約功能修復指南

## 快速修復步驟

### 步驟 1：設置資料庫配置

如果預約功能無法使用，最常見的原因是資料庫配置不正確。

**方法 1：使用快速設置工具（推薦）**

```bash
python 快速設置資料庫.py
```

按照提示輸入您的 MySQL 資料庫資訊：
- MySQL 主機地址（預設：localhost）
- MySQL 使用者名稱（預設：root）
- MySQL 密碼（**必須輸入**）
- 資料庫名稱（預設：medical_db）

**方法 2：手動創建 .env 文件**

在專案根目錄創建 `.env` 文件，添加以下內容：

```env
# MySQL 資料庫配置
DB_HOST=localhost
DB_USER=root
DB_PASSWORD=您的MySQL密碼
DB_NAME=medical_db
```

### 步驟 2：確認 MySQL 服務運行

**Windows:**
1. 打開「服務」（Win + R，輸入 `services.msc`）
2. 找到 MySQL 服務，確認狀態為「正在運行」
3. 如果未運行，右鍵點擊選擇「啟動」

**或使用命令列（管理員權限）：**
```bash
net start MySQL
```

### 步驟 3：創建資料庫（如果不存在）

登入 MySQL 並執行：

```sql
CREATE DATABASE medical_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 步驟 4：測試連接

執行診斷工具來測試資料庫連接：

```bash
python 檢查預約功能.py
```

如果看到以下訊息，表示連接成功：
```
✅ 資料庫連接成功
✅ 資料表 'medical_appointments' 存在
```

### 步驟 5：啟動應用程式

```bash
python app.py
```

然後在瀏覽器中訪問：
- 首頁：http://localhost:5000
- 登入後訪問：http://localhost:5000/appointment

## 常見問題

### 問題 1：資料庫連接失敗

**錯誤訊息：**
```
❌ 資料庫連接失敗: (1045, "Access denied for user...")
```

**解決方法：**
1. 確認 MySQL 密碼是否正確
2. 確認 MySQL 服務正在運行
3. 確認使用者名稱正確

### 問題 2：資料庫不存在

**錯誤訊息：**
```
❌ 資料庫連接失敗: (1049, "Unknown database 'medical_db'")
```

**解決方法：**
執行以下 SQL 創建資料庫：
```sql
CREATE DATABASE medical_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 問題 3：未登入系統

**症狀：**
- 點擊「預約門診」後被重定向到登入頁面

**解決方法：**
1. 先登入系統
2. 預設帳號：admin，密碼：1234
3. 或註冊新帳號

### 問題 4：表單驗證失敗

**錯誤訊息：**
```
請填寫所有必填欄位：...
```

**解決方法：**
確認所有必填欄位都已填寫：
- ✅ 病患姓名
- ✅ 聯絡電話
- ✅ 科別
- ✅ 醫師姓名
- ✅ 預約日期（必須是明天或之後）
- ✅ 預約時間

## 檢查清單

使用預約功能前，請確認：

- [ ] `.env` 文件存在且配置正確
- [ ] MySQL 服務正在運行
- [ ] 資料庫 `medical_db` 已創建
- [ ] 已登入系統
- [ ] 所有必填欄位都已填寫
- [ ] 預約日期是明天或之後

## 需要更多幫助？

如果以上方法都無法解決問題：

1. 執行 `python 檢查預約功能.py` 查看詳細診斷
2. 查看應用程式啟動時的日誌輸出
3. 檢查瀏覽器控制台是否有 JavaScript 錯誤
4. 確認所有依賴套件已安裝：`pip install -r requirements.txt`

